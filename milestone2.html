<!DOCTYPE html>
<!-- ECE 3400 | Fall 2018
website for Team 21
Created: 08/29/2018
Updated: 11/29/2018 -->

<html lang="en">

  <head>
    <meta name="referrer" content="origin">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Used to document the work of Team 21 during the
    Fall 2018 semester of ECE 3400: Intelligent Physical Systems at Cornell University">
    <meta name="keywords" content="Cornell, Engineering, ECE 3400, Robotics, Maze, Win">
    <meta name="author" content="​Brian Richard, Eric Lei, Kenneth Fang, Tyler Sherman">

    <title>ECE 3400 | Fall 2018 - Team 21</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>

    <!-- Custom styles for this template -->
    <link href="css/agency.css" rel="stylesheet">
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?skin=desert"></script>

    <!--favicon support for all modern browsers / mobile devices-->
    <link rel="apple-touch-icon" sizes="180x180" href="img/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon/favicon-16x16.png">
    <link rel="manifest" href="img/favicon/site.webmanifest">
    <link rel="mask-icon" href="img/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="img/favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="img/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

  </head>


  <body id="page-top">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav">
      <div class="container">
        <a class="navbar-brand js-scroll-trigger" href="#page-top">ECE 3400 - Team 21</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          Menu
          <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav text-uppercase ml-auto">
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="index.html">Home</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Milestones
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="milestone1.html#report">Milestone 1</a>
                <a class="dropdown-item" href="milestone2.html#report">Milestone 2</a>
                <a class="dropdown-item" href="milestone3.html#report">Milestone 3</a>
                <a class="dropdown-item" href="milestone4.html#report">Milestone 4</a>
              </div>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Labs
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="lab1.html#report">Lab 1</a>
                <a class="dropdown-item" href="lab2.html#report">Lab 2</a>
                <a class="dropdown-item" href="lab3.html#report">Lab 3</a>
                <a class="dropdown-item" href="lab4.html#report">Lab 4</a>
              </div>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Links
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="team-contract.html#contract">Team Contract</a>
                <a class="dropdown-item" href="meeting-minutes.html#minutes">Meeting Minutes</a>
                <a class="dropdown-item" href="ethics.html#assignment">Ethics Homework</a>
                <a class="dropdown-item" href="final-integration.html#design">System Integration</a>
              </div>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" target="_blank" href="https://github.com/ECE3400-FA18-Group21/ECE3400-FA18-Group21.github.io/tree/master">Github</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Header -->
    <header class="masthead">
      <div class="container">
        <div class="intro-text">
          <div class="intro-lead-in">Milestone 2</div>
          <div class="intro-heading text-uppercase">Right-Hand Wall Following</div>
          <a class="btn btn-primary btn-xl text-uppercase js-scroll-trigger" href="#report">Read the Report</a>
        </div>
      </div>
    </header>

    <!--THIS IS WHERE THE TEXT WILL GO-->
    <div class="container" id="report">
      <br><br>
      <h1 class="page-header text-center">Milestone 2</h1>
      <hr>
      <h4 class="page-header text-left">Milestone Goals</h4>
      <p>
        Integrate the following sensors and functionality:
        <ul>
          <li>2 × Parallax servo --> movement</li>
          <li>3 × Digital line sensor --> line tracking</li>
          <li>1 × IR phototransistor --> robot detection</li>
          <li>1 × Microphone --> 660 Hz detection</li>
          <li>3 × IR range finder --> wall detection</li>
        </ul>
        Demonstrate a robot that successfully circles an arbitrary set of walls
        through right-hand wall following, while performing line tracking, and
        detection and avoidance for other robots and walls.
      </p>
      <hr>
      <h4 class="page-header text-left">Wall Detection</h4>
      <ul class="list-bullet">
        <li>We installed three IR range finders on our robot</li>
        <ul>
          <li>Pointing straight ahead (in direction of movement)</li>
          <li>To the left</li>
          <li>To the right</li>
        </ul>
        <li>This arrangement allows us to detect both the presence and absence of walls around our robot</li>
        <li>We created two functions (with fairly self explanatory names) that read data from the range finders to detect walls:</li>
        <ul>
          <li>detect_wall_3in(int pin)</li>
          <li>detect_wall_6in(int pin)</li>
          <li>NOTE - we experimented with this setup to calibrate the threshold values</li>
        </ul>
        <li>Our IR range finder code is as follows:</li>
      </ul>
      <pre class="prettyprint"><code class="language-cpp">
      #define VAL_6_INCH 100
      #define VAL_3_INCH 200

      #include "ir_rangefinder.h"
      #include <Arduino.h>

      int read_range_sensor(int pin){
        return analogRead(pin);
      }
      bool detect_wall_6in(int pin){
        int val = read_range_sensor(pin);
        if(val > VAL_6_INCH)
          return true;
        else
          return false;
      }
      bool detect_wall_3in(int pin){
        int val = read_range_sensor(pin);
        if(val > VAL_3_INCH)
          return true;
        else
          return false;
      }
      </code></pre>
      <hr>
      <h4 class="page-header text-left">System Integration - <i>Attempt #1</i></h4>
      <ul class="list-bullet">
        <li>Create a loop that runs all processes one-after-another</li>
        <ul>
          <li>Begin by running the 660 Hz detection using the microphone circuit and mic FFT</li>
          <ul>
            <li>Run this continuously until 660 Hz is detected 5 consecutive times</li>
            <li>When this occurs, advance to the rest of the code and begin movement</li>
            <li>This code will not be run again</li>
          </ul>
          <li>Perform line tracking</li>
          <li>Perform wall detection</li>
          <li>Perform IR robot detection</li>
        </ul>
        <li>Analysis:</li>
        <ul>
          <li>Results are erratic; solution only partially works</li>
          <ul>
            <li>Sometimes line tracking suddenly fails</li>
            <li>Sometimes wall detection is too slow to respond</li>
            <li>Sometimes IR hat dection is too slow to respond</li>
            <li><u>Hypothesis</u> = the IR_hat FFT function call is affecting these processes</li>
          </ul>
          <li>The FFT library manually sets the ADC control registers</li>
          <ul>
            <li>This breaks the analogRead() function from the Arduino library</li>
            <li>Most of our functions utilize analogRead()</li>
          </ul>
        </ul>
      </ul>
      <hr>
      <h4 class="page-header text-left">Fixing the FFT</h4>
      <ul class="list-bullet">
        <li>The Open Music Labs Arduino FFT changes values in the following ADC control registers</li>
        <ul>
          <li>ADCSRA</li>
          <li>ADMUX</li>
          <li>TIMSK0</li>
          <li>DIDR0</li>
        </ul>
        <li>This causes the PWM library’s timer to not function correctly since it uses the same timer registers</li>
        <ul>
          <li>As a result, the servos do not behave in the intended manner</li>
        </ul>
        <li>Our solution stores the ADC register values before calling the FFT function</li>
        <ul>
          <li>We restore the ADC registers after the FFT function completes</li>
        </ul>
      </ul>
      <hr>
      <h4 class="page-header text-left">System Integration - <i>Attempt #2</i></h4>
      <p><u>GOAL: a robot that recognizes 660 Hz, does line tracking, and avoids robots and walls</u></p>
      <ul>
        <li>After implementing the afromentioned FFT code fix, we further refined our main loop</li>
        <ul>
          <li>Wait to begin operations until detect_660hz() returns TRUE 5 consecutive times</li>
          <ul>
            <li>The green LED indicates that 660 Hz was detected</li>
            <li>This is run in a separate loop from the below code</li>
            <li>It is never run again</li>
          </ul>
          <li>Check the line sensors and range finders - our conditional logic is:</li>
        </ul>
      </ul>
      <pre class="prettyprint"><code class="language-cpp">
      // wall detected at intersection
      if ((sensorStatus[0] == 0) && (sensorStatus[1] == 0) && (sensorStatus[2] == 0) && detect_wall_6in(3) ) {
            if (detect_wall_6in(1)){
              turnLeftIntersection(servo_L, servo_R);
            }
            else{
              turnRightIntersection(servo_L, servo_R);
            }
        }
        // wall detected but not at an intersection
        else if (detect_wall_3in(3)) {
          turnLeft(servo_L, servo_R);
        }
        // no wall detected --> just track the line
        else if (sensorStatus[0] == 0) //turn Right
          adjustRight(servo_L, servo_R, 85);
        else if (sensorStatus[2] == 0) //turn Left
          adjustLeft(servo_L, servo_R, 85);
        else {
          moveForward(servo_L, servo_R);
        }
      </code></pre>
      <ul>
        <ul>
          <li>Run detect_6080hz() to check for other robots</li>
          <ul>
            <li>This process is run in a <i>while</i> loop</li>
            <li>Our robot will stop moving and continuously check for the presence of another robot</li>
            <li>The red LED indicates that 6080 Hz is detected</li>
            <li>When no robot is detected anymore, our robot will resume normal operations</li>
          </ul>
        </ul>
        <li>NOTE - The IR detection circuit <i>does</i> correctly recognize the IR hat (another robot) and stop our robot</li>
        <ul>
          <li>The physical location of the phototransistor, however, is obstructed by other components</li>
          <li>This explains the difficulty Kenneth has getting the IR to be recognized</li>
          <li>We plan on moving the phototransistor to a more optimal, unobstructed location in the front of our robot</li>
        </ul>
      </ul>
      <div class="embed-responsive embed-responsive-21by9">
        <iframe width="560" height="315" src="https://www.youtube.com/embed/vv4UNfixLkE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      <div class="container">
        <div class="row">
          <div class="col-md-3">
          </div>
          <div class="col-md-6">
            <span class="copyright">Copyright &copy; 2018, Team 21 of ECE 3400 | Fall 2018.
              <br>
              Theme Made Using <a target="_blank" href="http://getbootstrap.com">Bootstrap
            </span>
          </div>
          <div class="col-md-3">
            <ul class="list-inline quicklinks">
              <li class="list-inline-item">
                <a target="_blank" href="https://cei-lab.github.io/ece3400-2018/">ECE 3400 Course Page</a>
              </li>
            </ul>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4">
          </div>
          <div class="col-md-4">
            <ul class="list-inline social-buttons">
              <li class="list-inline-item">
                <a target="_blank" href="https://github.com/ECE3400-FA18-Group21/ECE3400-FA18-Group21.github.io/tree/master">
                  <i class="fab fa-github"></i>
                </a>
              </li>
            </ul>
          </div>
          <div class="col-md-4">
          </div>
        </div>
      </div>
    </footer>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Contact form JavaScript -->
    <script src="js/jqBootstrapValidation.js"></script>
    <script src="js/contact_me.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/agency.min.js"></script>

  </body>

</html>
