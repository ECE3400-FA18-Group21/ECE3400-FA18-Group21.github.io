<!DOCTYPE html>
<!-- ECE 3400 | Fall 2018
website for Team 21
Created: 08/29/2018
Updated: 10/21/2018 -->
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?skin=desert"></script>

<html lang="en">

  <head>
    <meta name="referrer" content="origin">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Used to document the work of Team 21 during the
    Fall 2018 semester of ECE 3400: Intelligent Physical Systems at Cornell University">
    <meta name="keywords" content="Cornell, Engineering, ECE 3400, Robotics, Maze, Win">
    <meta name="author" content="​Brian Richard, Eric Lei, Kenneth Fang, Tyler Sherman">

    <title>ECE 3400 | Fall 2018 - Team 21</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>

    <!-- Custom styles for this template -->
    <link href="css/agency.css" rel="stylesheet">

    <!--favicon support for all modern browsers / mobile devices-->
    <link rel="apple-touch-icon" sizes="180x180" href="img/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon/favicon-16x16.png">
    <link rel="manifest" href="img/favicon/site.webmanifest">
    <link rel="mask-icon" href="img/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="img/favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="img/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

  </head>


  <body id="page-top">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav">
      <div class="container">
        <a class="navbar-brand js-scroll-trigger" href="#page-top">ECE 3400 - Team 21</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          Menu
          <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav text-uppercase ml-auto">
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="index.html">Home</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Milestones
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="milestone1.html#report">Milestone 1</a>
                <a class="dropdown-item" href="milestone2.html#report">Milestone 2</a>
                <a class="dropdown-item" href="milestone3.html#report">Milestone 3</a>
                <a class="dropdown-item" href="milestone4.html#report">Milestone 4</a>
              </div>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Labs
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="lab1.html#report">Lab 1</a>
                <a class="dropdown-item" href="lab2.html#report">Lab 2</a>
                <a class="dropdown-item" href="lab3.html#report">Lab 3</a>
                <a class="dropdown-item" href="lab4.html#report">Lab 4</a>
              </div>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Links
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="team-contract.html#contract">Team Contract</a>
                <a class="dropdown-item" href="meeting-minutes.html#minutes">Meeting Minutes</a>
                <a class="dropdown-item" href="#">TBD 3</a>
                <a class="dropdown-item" href="#">TBD 4</a>
              </div>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" target="_blank" href="https://github.com/ECE3400-FA18-Group21/ECE3400-FA18-Group21.github.io/tree/master">Github</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Header -->
    <header class="masthead">
      <div class="container">
        <div class="intro-text">
          <div class="intro-lead-in">Lab 3</div>
          <div class="intro-heading text-uppercase">System Integration &amp Radio Communication</div>
          <a class="btn btn-primary btn-xl text-uppercase js-scroll-trigger" href="#report">Tell Me More</a>
        </div>
      </div>
    </header>

    <!--THIS IS WHERE THE TEXT WILL GO-->
    <div class="container" id="report">
      <br><br>
      <h1 class="page-header text-center">Lab 3</h1>
      <hr>

      <h4 class="page-header text-left">Lab Goals</h4>
      <p>
        Integrate all components previously worked on in labs 1-2 and
        milestones 1-2. This consists of creating a robot that:
        <ul>
          <li>Starts on a 660 Hz tone</li>
          <li>Navigates a small test maze autonomously</li>
          <li>Sends maze information it discovers wirelessly to a base station</li>
          <li>Displays the updates on the base station (used for debugging)</li>
        </ul>
        One group will work on the radio component and the other on integrating
        the various functionality. At the end of the lab, this work will be
        unified so that the robot can run through the maze and update the GUI
        as it explores.
      </p>
      <h4 class="page-header text-left">Prelab</h4>
      <ul class="list-bullet">
      	<li>Discuss method to encode maze information</li>
      	<ul>
      		<li>Kenneth designed <i>Maze</i> class and software hierarchy
      	</ul>
      	<li>Final maze has the following specifications:</li>
      	<ul>
      		<li>9 × 9 squares</li>
      		<li>Each square can be explored or unexplored</li>
      		<li>Each square can have walls on either and all sides</li>
      		<li>Each square can have treasures (with three shapes and two colors</li>
      		<li>Each square can potentially have other robots or decoys</li>
      	</ul>
      	<li>Review and install the <a target="_blank" href="http://maniacbug.github.io/RF24/classRF24.html">RF24 Arduino Library</a></li>
      	<li>Review and instal the TA designed <a target="_blank" href="https://github.com/backhous/ece3400-maze-gui">graphical user interface (GUI)</a></li>
      </ul>
      <h4 class="page-header text-left">Sub-Teams</h4>
      <p>To begin, we split into two groups of two. Each group progressed
        through the lab individually, as described below.
      </p>
      <ul class="list-bullet">
        <li>Robot Integration Team = Brian and Kenneth</li>
        <li>Radio Team = Eric and Tyler</li>
        <li>NOTE - due to the complexity and interconnectedness of the functions
          in this lab, we frequently came together as one large group to track
          progress and talk through issues</li>
      </ul>
      <hr>
      <h3 class="page-header text-center">Radio Team</h3>
      <p><u>GOAL: send maze information wirelessly between Arduino’s</u></p>
      <h4 class="page-header text-left">Materials Used</h4>
      <ul>
        <li>2 × Arduino Uno</li>
        <li>2 × <a target="_blank" href="https://www.sparkfun.com/datasheets/Components/SMD/nRF24L01Pluss_Preliminary_Product_Specification_v1_0.pdf">Nordic nRF24L01+ transceivers</a></li>
        <li>16 × Female-to-Male jumper wire (instead of the radio breakout board with header)</li>
        <ul>
          <li>NOTE - we crimped these wire connectors ourselves</li>
        </ul>
      </ul>
      <h4 class="page-header text-left">Getting Started</h4>
      <ul>
        <li>Plug the 2 radios into our 2 Arduinos using the female-to-male jumper wires we constructed</li>
        <ul>
          <li>IMPORTANT - the radios use <b>3.3V, NOT 5V</b></li>
          <li>Initially, we powered the radios using the Bench Power Supply</li>
          <ul>
            <li>This allowed us to observe the current draw</li>
            <li>We used this to test to make sure our hardware was not broken</li>
          </ul>
          <li>Once we got our system working, we transitioned to using the 3.3V pin on the Arduino</li>
        </ul>
        <li>Instead of using the recommended RF24 Arduino Library, we used a newer, optimized version</li>
        <ul>
          <li>Recommended --> <a target="_blank" href="https://github.com/maniacbug/RF24">RF24 Arduino Library</a> (last updated 5 years ago)</li>
          <li>What we used --> <a target="_blank" href="https://github.com/nRF24/RF24">Optimized fork of nRF24L01 for Arduino</a> (currently being updated)</li>
          <ul>
            <li>Documentation and Class Reference page: <a target="_blank" href="http://tmrh20.github.io/RF24/Official">LINK</a></li>
          </ul>
        </ul>
        <li>To begin, we used the "GettingStarted" example sketche</li>
        <li>We changed the address identifier numbers for our system as specified in the lab instructions</li>
        <ul>
          <li>Formula: 2(3D+N)+X</li>
          <li>D (day of lab) = 4 (Thursday)</li>
          <li>N (team number) = 21</li>
          <li>X (radio designator) = 0 for one radio, 1 for the other radio (need two identifiers)</li>
          <li><u>Channel Numbers</u> = 110 and 111 in decimal = <b>0x6E</b> and <b>0x6F</b> in hex</li>
          <pre class="prettyprint"><code class="language-cpp">
            const uint64_t addresses[][2] = {0x000000006ELL, 0x000000006FLL};
          </code></pre>
        </ul>
      </ul>
      <h4 class="page-header text-left">Testing the Radios</h4>
      <ul>
        <li>We programmed the "GettingStarted" sketch onto both Arduinos</li>
        <ul>
          <li>Allowed us to open a serial monitor for each radio simultaneously</li>
        </ul>
        <li>Initial Issues:</li>
        <ul>
          <li>Broken hardware</li>
          <li>Broken female-to-male jumper wire (no connectivity)</li>
        </ul>
        <li>After addressing these issues, we were able to experiment with the radios</li>
        <li>We cycled through the power level settings to test the range</li>
        <ul>
          <li>Minimum of 15 feet range is needed for the final competition</li>
          <ul>
            <li>RF24_PA_MIN = 7 feet</li>
            <li>RF24_PA_LOW = 10 feet</li>
            <li>RF24_PA_HIGH = 17 feet</li>
            <li>RF24_PA_MAX = 25 feet --> we decided to use this for extra reliability</li>
          </ul>
          <li>NOTE - straight-line distance was measured in the hallway with no obstructions</li>
          <li>NOTE - these were found to be the values at which no packet-loss was detected for 25 consecutives transmissions</li>
        </ul>
      </ul>
      <h4 class="page-header text-left">Sending Maze Information Between Arduinos</h4>
      <ul>
        <li>Our software is structured such that a Maze object is stored on both the Robot and the Base Station</li>
        <ul>
            <li>The Maze object is updated using one of the following commands:</li>
            <ol>
              <li>turnLeft()</li>
              <li>turnRight()</li>
              <li>advanceIntersection()</li>
            </ol>
        </ul>
        <li>At a high-level, this process looks as follows</li>
        <ol>
          <li>Robot logic determines what movement to take and updates its Maze object</li>
          <li>Robot encodes the Maze update function using the chart below</li>
          <li>Robot transmits this instruction, in 1 byte, to the base station</li>
          <li>Base station receives the 1 byte instruction</li>
          <li>Base station decodes the instruction using the chart below</li>
          <li>Base station calls the Maze update method, which keeps the two Maze objects equivalent</li>
        </ol>
        <li>Due to the simplicity of this structure, we can encode all of the information in 1 byte</li>
        <li>Our receiver is set to send an Ack Payload confirming receipt of the instruction</li>
        <ul>
          <li>We intend on making this error checking more robust</li>
        </ul>
      </ul>
      <div class="container">
        <div class="row">
          <div class="col-md-3">
          </div>
          <div class="col-md-6">
            <div class="thumbnail">
              <img src="img/lab3/Base_station_decoder.png" style="width:100%">
              <div class="caption text-center">
                <p>Figure 1 - Byte encoding chart</p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
          </div>
        </div>
      </div>
      <h4 class="page-header text-left">Creating the Base Station</h4>
      <ul>
        <li>Our base station Arduino is programmed with a different main sketch than our robot</li>
        <ul>
          <li>Although they share sub-function libraries (.cpp and .h files)</li>
          <ul>
            <li>Maze.h and Maze.cpp</li>
            <li>nordic_rf.h and nordic_rf.cpp</li>
            <ul>
              <li>Robot is hard-coded to perform <i>Transmitter</i> setup and only call <i>Transmitter</i> functions</li>
              <li>Base station is hard-coded to perform <i>Receiver</i> setup and only call <i>Receiver</i> functions</li>
            </ul>
          </ul>
        </ul>
        <li>The base station has a main loop that runs the following processes:</li>
        <ul>
          <li>Receive transmission from robot (1 byte)</li>
          <li>Decode the transmission using the table in Figure 1 (above)</li>
          <li>Run the required command to update the base station Maze object</li>
          <li>Transmit the updated information to the GUI</li>
          <ul>
            <li>Calls the command: getGUIMessage(byte x, byte y)</li>
            <li>x = current x location = getX()</li>
            <li>y = current y location = getY()</li>
          </ul>
        </ul>
      </ul>



      <!-- @TO-DO -->
      <h4 class="page-header text-left">Base Station-to-GUI Transmission</h4>
      <ul>
        <li>FROM THE LAB INSTRUCTIONS: One this works, think about the software
          architecture on your base station. How often do you want to
          communicate with the GUI? All the time, or could you make this an
          event-driven operation?</li>
        <li></li>
        <li></li>
        <li></li>
      </ul>
      <hr>

      <h3 class="page-header text-center">Robot Integration Group</h3>
      <p><u>GOAL: Robot-to-GUI integration, full exploration, and update the GUI</u></p>
      <div class="container">
        <div class="row">
          <div class="col-md-8">
            <h4 class="page-header text-left">Materials Used</h4>
            <ul>
              <li>Our robot</li>
              <li>All code from past labs</li>
              <li>IR Decoy</li>
              <li>660 Hz tone generator</li>
              <li>Partner with another team to show robot avoidance</li>
              <li>Walls to make the maze set up (follow this layout</li>
            </ul>
          </div>
          <div class="col-md-4">
            <div class="thumbnail">
              <img src="img/lab3/Maze_Layout.png" style="width:100%">
              <div class="caption text-center">
                <p>Maze layout for testing</p>
              </div>
            </div>
          </div>
        </div>
      </div>



      <!-- @TO-DO -->
      <h4 class="page-header text-left">Discuss Data Sotrage / Maze Object</h4>
      <ul>
        <li></li>
      </ul>
      <h4 class="page-header text-left">INFO</h4>
      <ul>
        <li></li>
      </ul>

      <h4 class="page-header text-left">Integrate Radio Communication into Software</h4>
      <ul>
        <li>Since we had done such a good job integrating our systems for Milestone 2, minimal changes had to be made for Lab 3</li>
        <li>First, we integrated our new sub-function libraries</li>
        <ul>
          <li>Maze.h and Maze.cpp</li>
          <li>nordic_rf.h and nordic_rf.cpp</li>
          <li>As previously mentioned, these are the exact same files that the base station uses (modularity!)</li>
        </ul>
        <li>Second, we updated our main loop movement logic</li>
        <ul>
          <li>The code is identical to the code from Milestone 2, with the addition of just 5 new lines</li>
        </ul>
      </ul>
      <pre class="prettyprint"><code class="language-cpp">
      // wall detected at intersection
      if ((sensorStatus[0] == 0) && (sensorStatus[1] == 0) && (sensorStatus[2] == 0) && detect_wall_6in(3) ) {
            if (detect_wall_6in(1)){
              turnLeftIntersection(servo_L, servo_R);
              send_advance_intersection(radio, true, false, true);  //NEW LINE
              send_turn_left(radio);                                //NEW LINE
            }
            else{
              turnRightIntersection(servo_L, servo_R);
              send_advance_intersection(radio, true, false, false); //NEW LINE
              send_turn_right(radio);                               //NEW LINE
            }
        }
        // wall detected but not at an intersection
        else if (detect_wall_3in(3)) {
          turnLeft(servo_L, servo_R);
          send_turn_left(radio);                                    //NEW LINE
        }
        // no wall detected --> just track the line
        else if (sensorStatus[0] == 0) //turn Right
          adjustRight(servo_L, servo_R, 85);
        else if (sensorStatus[2] == 0) //turn Left
          adjustLeft(servo_L, servo_R, 85);
        else {
          moveForward(servo_L, servo_R);
        }
      </code></pre>
      <hr>

      <!-- @TO-DO -->
      <h3 class="page-header text-center">Full System Testing</h3>
      <p>REPLACE THIS LINK WITH THE REAL VIDEO AFTER WE TAKE IT</p>
      <div class="embed-responsive embed-responsive-21by9">
        <iframe width="560" height="315" src="https://www.youtube.com/embed/7NOfNRjhc0I" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      <div class="container">
        <div class="row">
          <div class="col-md-3">
          </div>
          <div class="col-md-6">
            <span class="copyright">Copyright &copy; 2018, Team 21 of ECE 3400 | Fall 2018.
              <br>
              Theme Made Using <a target="_blank" href="http://getbootstrap.com">Bootstrap
            </span>
          </div>
          <div class="col-md-3">
            <ul class="list-inline quicklinks">
              <li class="list-inline-item">
                <a target="_blank" href="https://cei-lab.github.io/ece3400-2018/">ECE 3400 Course Page</a>
              </li>
            </ul>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4">
          </div>
          <div class="col-md-4">
            <ul class="list-inline social-buttons">
              <li class="list-inline-item">
                <a target="_blank" href="https://github.com/ECE3400-FA18-Group21/ECE3400-FA18-Group21.github.io/tree/master">
                  <i class="fab fa-github"></i>
                </a>
              </li>
            </ul>
          </div>
          <div class="col-md-4">
          </div>
        </div>
      </div>
    </footer>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Contact form JavaScript -->
    <script src="js/jqBootstrapValidation.js"></script>
    <script src="js/contact_me.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/agency.min.js"></script>

  </body>

</html>
