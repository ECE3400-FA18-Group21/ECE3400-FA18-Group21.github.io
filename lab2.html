<!DOCTYPE html>
<!-- ECE 3400 | Fall 2018
website for Team 21
Created: 08/29/2018
Updated: 09/29/2018 -->
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?skin=desert"></script>

<html lang="en">

  <head>
    <meta name="referrer" content="origin">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Used to document the work of Team 21 during the
    Fall 2018 semester of ECE 3400: Intelligent Physical Systems at Cornell University">
    <meta name="keywords" content="Cornell, Engineering, ECE 3400, Robotics, Maze, Win">
    <meta name="author" content="​Brian Richard, Eric Lei, Kenneth Fang, Tyler Sherman">

    <title>ECE 3400 | Fall 2018 - Team 21</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>

    <!-- Custom styles for this template -->
    <link href="css/agency.css" rel="stylesheet">

    <!--favicon support for all modern browsers / mobile devices-->
    <link rel="apple-touch-icon" sizes="180x180" href="img/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon/favicon-16x16.png">
    <link rel="manifest" href="img/favicon/site.webmanifest">
    <link rel="mask-icon" href="img/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="img/favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="img/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

  </head>


  <body id="page-top">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav">
      <div class="container">
        <a class="navbar-brand js-scroll-trigger" href="#page-top">ECE 3400 - Team 21</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          Menu
          <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav text-uppercase ml-auto">
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="index.html">Home</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Milestones
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="milestone1.html#report">Milestone 1</a>
                <a class="dropdown-item" href="milestone2.html#report">Milestone 2</a>
                <a class="dropdown-item" href="milestone3.html#report">Milestone 3</a>
                <a class="dropdown-item" href="milestone4.html#report">Milestone 4</a>
              </div>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Labs
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="lab1.html#report">Lab 1</a>
                <a class="dropdown-item" href="lab2.html#report">Lab 2</a>
                <a class="dropdown-item" href="lab3.html#report">Lab 3</a>
                <a class="dropdown-item" href="lab4.html#report">Lab 4</a>
              </div>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Links
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="team-contract.html#contract">Team Contract</a>
                <a class="dropdown-item" href="meeting-minutes.html#minutes">Meeting Minutes</a>
                <a class="dropdown-item" href="#">TBD 3</a>
                <a class="dropdown-item" href="#">TBD 4</a>
              </div>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" target="_blank" href="https://github.com/ECE3400-FA18-Group21/ECE3400-FA18-Group21.github.io/tree/master">Github</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Header -->
    <header class="masthead">
      <div class="container">
        <div class="intro-text">
          <div class="intro-lead-in">Lab 2</div>
          <div class="intro-heading text-uppercase">Analog Circuitry & FFTs</div>
          <a class="btn btn-primary btn-xl text-uppercase js-scroll-trigger" href="#report">Read the Report</a>
        </div>
      </div>
    </header>

    <!--THIS IS WHERE THE TEXT WILL GO-->
    <div class="container" id="report">
      <br><br>
      <h1 class="page-header text-center">Lab 2</h1>
      <hr>
      <h4 class="page-header text-left">Lab Goals</h4>
      <p>Test and familiarize yourself with the sensors and signal
        processing needed for your robot to detect acoustic and
        optical signals and interface with the Arduino Uno. The
        Acoustic sub-team will work on the microphone circuit, which
        will detect a 660 Hz whistle blow, signifying the start of
        the maze mapping competition. The Optical sub-team will work
        on the IR sensor circuit, which will detect nearby robots
        emitting IR at 6.08 kHz and distinguish them from decoys
        emitting at 18 kHz.
      </p>
      <h4 class="page-header text-left">Prelab</h4>
      <ul class="list-bullet">
        <li>Review documentation for the analog-to-digital converter on the <a class="_blank" href="http://ww1.microchip.com/downloads/en/DeviceDoc/Atmel-42735-8-bit-AVR-Microcontroller-ATmega328-328P_Datasheet.pdf">ATmega328</a> (Arduino microcontroller)</li>
        <li>Review documentation for <a class="_blank" href="http://wiki.openmusiclabs.com/wiki/ArduinoFFT">Open Music Labs Arduino FFT Library</a></li>
        <ul>
          <li>Read about Fourier Transforms</li>
          <li>Read about Fast Fourier Transforms (FFT)</li>
        </ul>
        <li>Find a website to generate the <a class="_blank" href="http://www.szynalski.com/tone-generator/">660 Hz tone</a> for testing</li>
        <li>Design simple analog amplifying and filtering circuits</li>
      </ul>
      <h4 class="page-header text-left">Sub-Teams</h4>
      <p>To begin, we split into two groups of two. Each group progressed
        through the lab individually, as described below.
      </p>
      <ul class="list-bullet">
        <li>Acoustic Team = Kenneth and Tyler</li>
        <li>Optical Team = Brian and Eric</li>
      </ul>
      <h4 class="page-header text-left">FFT Analysis</h4>
      <p>Both the Acoustic and Optical parts of this lab used Fast Fourier
        Transforms (FFT) to determine the frequency components of the sampled
        input signal from the sensors. <b>FFT ALGORITHM EXPLANATION.</b>
        <br><br>
        The FFT algorithm was implemented using Open Music Labs Arduino FFT
        Library. By default, the library takes in an analog signal from Arduino
        pin A0, samples it at 256 equally spaced intervals, and returns an array
        with 128 values, which represent the magnitude of the frequency content
        over a small range of frequencies. Since the FFT of a real signal is
        symmetric over zero, only half of the outputs are unique, and thus 128
        bins are returned (not 256).
        <br><br>
        To test and visualize the data, we used the example code "fft_adc_serial,"
        which prints the FFT magnitude data to the serial monitor. We then copied
        the data into Excel, and wrote a simple MATLAB script to read in and plot
        the data.
      </p>
      <hr>
      <h3 class="page-header text-center">Acoustic Team</h3>
      <h4 class="page-header text-left">Materials Used</h4>
      <ul>
        <li>1 × Arduino Uno</li>
        <li>1 × USB A/B cable</li>
        <li>1 × Electret Condenser Microphone (<a class="_blank" href="https://www.cui.com/product/resource/cma-4544pf-w.pdf">CMA-4544PF-W</a>)</li>
        <li>1 × <a class="_blank" href="http://www.ti.com/lit/ds/symlink/lm158-n.pdf">LM358</a> Op Amp</li>
        <li>1 × 1 μF Polarized Capacitor</li>
        <li>1 × 220 pF Capacitor</li>
        <li>1 × 330 pF Capacitor</li>
        <li>1 × 330 Ω resistor</li>
        <li>1 × 3.3 kΩ resistor</li>
        <li>1 × 3.9 kΩ resistor</li>
        <li>2 × 10 kΩ resistors</li>
        <li>1 × 390 kΩ resistor</li>
        <li>2 × 680 kΩ resistor</li>
        <li>1 Solderless breadboard</li>
      </ul>
      <hr>
      <h3 class="page-header text-center">Optical Team</h3>
      <p><u>GOAL: use an Arduino and the FFT library to detect another robot
        emitting IR at 6.08kHz and ignore decoys (18kHz)</u></p>
      <h4 class="page-header text-left">Materials Used</h4>
      <ul>
        <li>1 × Arduino Uno</li>
        <li>1 × USB A/B cable</li>
        <li>1 × IR Phototransistor (<a class="_blank" href="http://www.mouser.com/ds/2/414/OP793-798-30653.pdf">OP598</a>)</li>
        <li>1 × IR hat (given by TAs)</li>
        <li>1 × IR decoy</li>
        <li>1 × <a class="_blank" href="http://www.ti.com/lit/ds/symlink/lf353-n.pdf">LF353</a> Op Amp</li>
        <li>1 × 2.3 μF Capacitor</li>
        <li>1 × 10 nF Capacitor</li>
        <li>1 × 10 Ω resistor</li>
        <li>1 × 3.2 kΩ resistor</li>
        <li>1 Solderless breadboard</li>
      </ul>
      <h4 class="page-header text-left">IR Circuit Design</h4>
      <div class="container">
        <div class="row">
          <div class="col-md-8">
            <ul>
              <li>We chose to implement an active band-pass filter with amplification in order to filter out DC and low frequency signals while also filtering out the higher frequency decoy signals</li>
              <li>Received IR signals in the pass band (from other robots’ IR hats) are amplified for better ADC quantization range, as well as to detect them from further distances</li>
              <li>Cut-off frequencies were intended to be 5 kHz and 7 kHz</li>
              <li>Our capacitor and resistor values were:</li>
              <ul>
                <li>R1 = 10 Ω</li>
                <li>C1 = 2.3 μF</li>
                <li>R2 = 3.2 kΩ</li>
                <li>C2 = 10 nF</li>
              </ul>
              <li>This resulted in cut-off frequencies of 4.97 kHz and 6.92 kHz</li>
              <li>The gain of the filter in the pass band was intended to be R2/R1 = 320</li>
              <li>Actual results:</li>
              <ul>
              	<li>Peak Gain: 75 or 19dB</li>
              	<li>Bode Plot</li>
              	<ul>
              		<li>Shows bandpass filter with 3dB bandwidth 700Hz to 10kHz</li>
              		<li>18kHz signal is half the power of the 6kHz signal after active filter</li>
              		<li>Harmonics of the 18kHz signal that would alias into the 6kHz bins come out of the filter with 1/10 the magnitude of a 6kHz signal</li>
              	</ul>
              </ul>
            </ul>
          </div>
          <div class="col-md-4">
            <div class="thumbnail">
              <img src="img/lab2/BPF.png" style="width:100%">
              <div class="caption text-center">
                <p>Band-pass filter schematic (from Professor Shealy, ECE2200 course notes)</p>
              </div>
            </div>
            <div class="thumbnail">
              <img src="img/lab2/ir_filter_bode.png" style="width:100%">
              <div class="caption text-center">
                <p>IR filter bode plot</p>
              </div>
            </div>
          </div>
        </div>
      <h4 class="page-header text-left">FFT Analysis</h4>
      <ul>
        <li>As mentioned earlier, we use the Open Labs Arduino FFT Library for calculating the FFT</li>
        <li>The default example code sets the ADC in free running mode and polls for each ADC conversion</li>
        <ul>
        	<li>ADC prescaler = 32</li>
        	<ul>
        		<li>NOTE - this ADC setup is different from the one used by the Acoustic Team</li>
        	</ul>
        	<li>Arduino clock frequency = 16 MHz</li>
        	<li>Thus, sampling frequency = 38.4 kHz</li>
          </ul>
        <li>This is quick enough for the purpose of detecting IR signals, since we are sampling above the Nyquist rate, and the highest frequency IR signal we will see is 18 kHz</li>
        <ul>
        	<li>However, we may still see harmonics of these signals that are aliased to lower frequencies, since a sinusoidal input to a diode will cause harmonics</li>
        	<li>Given our sampling rate and decoy frequency, we expect these aliased signals to appear at frequencies that are filtered out by our band pass filter</li>
        </ul>
        <li>The FFT code outputs 128 bins</li>
        <ul>
        	<li>Frequencies of interest are in bins 41 and 42</li>
        	<li>This corresponds to 6.01 kHz and 6.16 kHz</li>
        </ul>
      </ul>
      <h4 class="page-header text-left">Results</h4>
      <div class="container">
        <div class="row">
          <div class="col-md-6">
            <p><u>Silence</u></p>
            <div class="thumbnail">
              <img src="img/lab2/silence.png" style="width:100%">
              <div class="caption">
                <ul>
                  <li>Spectrum is pretty sparse</li>
                  <li>There are some small peaks around 8 kHz and 13 kHz</li>
                </ul>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <p><u>IR Hat</u></p>
            <div class="thumbnail">
              <img src="img/lab2/IR_detected.png" style="width:100%">
              <div class="caption">
                <ul>
                  <li>There is a large peak at 6160 Hz</li>
                  <li>Bins 41 and 42 correspond to the 6 kHz IR hat signal</li>
                  <li>When the peaks in these bins are above a threshold, then the IR hat signal is detected</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <p><u>IR Decoy</u></p>
            <div class="thumbnail">
              <img src="img/lab2/decoy_only.png" style="width:100%">
              <div class="caption">
                <ul>
                  <li>There is a peak corresponding to 18 kHz on the spectrum</li>
                  <li>No frequencies are aliased to the bins around 6 kHz</li>
                  <li>Thus, we can ignore the 18 kHz peak and only observe bins 41 and 42 for IR hat detection</li>
                </ul>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <p><u>IR Hat + IR Decoy</u></p>
            <div class="thumbnail">
              <img src="img/lab2/IR_and_decoy.png" style="width:100%">
              <div class="caption">
                <ul>
                  <li>There are peaks at 6 kHz and 18 kHz</li>
                  <li>Ignore the 18 kHz bins</li>
                  <li>Observe bins 41 and 42 for IR hat detection</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

    <!-- Footer -->
    <footer>
      <div class="container">
        <div class="row">
          <div class="col-md-3">
          </div>
          <div class="col-md-6">
            <span class="copyright">Copyright &copy; 2018, Team 21 of ECE 3400 | Fall 2018.
              <br>
              Theme Made Using <a target="_blank" href="http://getbootstrap.com">Bootstrap
            </span>
          </div>
          <div class="col-md-3">
            <ul class="list-inline quicklinks">
              <li class="list-inline-item">
                <a target="_blank" href="https://cei-lab.github.io/ece3400-2018/">ECE 3400 Course Page</a>
              </li>
            </ul>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4">
          </div>
          <div class="col-md-4">
            <ul class="list-inline social-buttons">
              <li class="list-inline-item">
                <a target="_blank" href="https://github.com/ECE3400-FA18-Group21/ECE3400-FA18-Group21.github.io/tree/master">
                  <i class="fab fa-github"></i>
                </a>
              </li>
            </ul>
          </div>
          <div class="col-md-4">
          </div>
        </div>
      </div>
    </footer>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Contact form JavaScript -->
    <script src="js/jqBootstrapValidation.js"></script>
    <script src="js/contact_me.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/agency.min.js"></script>

  </body>

</html>
